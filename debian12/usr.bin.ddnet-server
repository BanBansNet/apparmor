# vim:syntax=apparmor
abi <abi/3.0>,

include <tunables/global>

profile ddnet-server /usr/bin/DDNet-Server {
  network inet dgram,
  network inet6 dgram,

  signal,

  /dev/urandom mr,
  /etc/gai.conf r,
  /etc/host.conf r,
  /etc/hosts r,
  /etc/ld.so.cache r,
  /etc/nsswitch.conf r,
  /etc/resolv.conf r,
  /etc/ssl/certs/ca-certificates.crt r,
  /etc/ssl/openssl.cnf r,
  /proc/sys/crypto/fips_enabled r,
  /run/systemd/resolve/stub-resolv.conf r,
  /usr/lib/os-release r,

  /usr/lib/x86_64-linux-gnu/libcrypto.so.3 mr,
  /usr/lib/x86_64-linux-gnu/libc.so.6 mr,
  /usr/lib/x86_64-linux-gnu/libnghttp2.so.14.24.1 mr,
  /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.8 mr,
  /usr/lib/x86_64-linux-gnu/librtmp.so.1 mr,
  /usr/lib/x86_64-linux-gnu/libssh2.so.1.0.1 mr,
  /usr/lib/x86_64-linux-gnu/libpsl.so.5.3.4 mr,
  /usr/lib/x86_64-linux-gnu/libssl.so.3 mr,
  /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2.2 mr,
  /usr/lib/x86_64-linux-gnu/libldap-2.5.so.0.1.8 mr,
  /usr/lib/x86_64-linux-gnu/liblber-2.5.so.0.1.8 mr,
  /usr/lib/x86_64-linux-gnu/libzstd.so.1.5.4 mr,
  /usr/lib/x86_64-linux-gnu/libbrotlidec.so.1.0.9 mr,
  /usr/lib/x86_64-linux-gnu/libunistring.so.2.2.0 mr,
  /usr/lib/x86_64-linux-gnu/libgnutls.so.30.34.3 mr,
  /usr/lib/x86_64-linux-gnu/libhogweed.so.6.6 mr,
  /usr/lib/x86_64-linux-gnu/libnettle.so.8.6 mr,
  /usr/lib/x86_64-linux-gnu/libgmp.so.10.4.1 mr,
  /usr/lib/x86_64-linux-gnu/libkrb5.so.3.3 mr,
  /usr/lib/x86_64-linux-gnu/libk5crypto.so.3.1 mr,
  /usr/lib/x86_64-linux-gnu/libcom_err.so.2.1 mr,
  /usr/lib/x86_64-linux-gnu/libkrb5support.so.0.1 mr,
  /usr/lib/x86_64-linux-gnu/libsasl2.so.2.0.25 mr,
  /usr/lib/x86_64-linux-gnu/libbrotlicommon.so.1.0.9 mr,
  /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.0 mr,
  /usr/lib/x86_64-linux-gnu/libtasn1.so.6.6.3 mr,
  /usr/lib/x86_64-linux-gnu/libkeyutils.so.1.10 mr,
  /usr/lib/x86_64-linux-gnu/libresolv.so.2 mr,
  /usr/lib/x86_64-linux-gnu/libffi.so.8.1.2 mr,

  /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1 mr,
  /usr/lib/x86_64-linux-gnu/libcurl.so.4.8.0 mr,
  /usr/lib/x86_64-linux-gnu/libdl.so.2 mr,
  /usr/lib/x86_64-linux-gnu/libgcc_s.so.1 mr,
  /usr/lib/x86_64-linux-gnu/libm.so.6 mr,
  /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6 mr,
  /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30 mr,
  /usr/lib/x86_64-linux-gnu/libz.so.1.2.13 mr,

  /usr/share/ddnet/data/censorlist.txt r,
  /usr/share/ddnet/data/maps/*.map r,
  /usr/share/ddnet/data/wordlist.txt r,
  /usr/share/zoneinfo/Europe/Berlin r,
  @{HOME}/.local/share/ddnet/autoexec_server.log w,
  @{HOME}/.{teeworlds,ddnet}/autoexec_server.cfg r,
  @{HOME}/.{teeworlds,ddnet}/ddnet-server.sqlite rwk,
  @{HOME}/.{teeworlds,ddnet}/ddnet-server.sqlite-shm rwk,
  @{HOME}/.{teeworlds,ddnet}/ddnet-server.sqlite-wal rwk,
  @{HOME}/.{teeworlds,ddnet}/debug.txt r,
  @{HOME}/.{teeworlds,ddnet}/dumps/*.{log,txt} w,
  @{HOME}/.{teeworlds,ddnet}/maps/*.map r,
}
